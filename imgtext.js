let selectedOcrFile=null;function openOcrModal(){"function"==typeof setActiveMode&&setActiveMode("mode-ocr-converter");var e=document.getElementById("ocrModal");e&&(e.style.display="flex",document.body.style.overflow="hidden")}function closeOcrModal(){var e=document.getElementById("ocrModal");e&&(e.style.display="none",document.body.style.overflow="auto",selectedOcrFile=null,document.getElementById("ocrFileInput").value="",document.getElementById("ocrFileName").innerText="Select or Drag Image",document.getElementById("ocrStatus").textContent="Ready to scan",document.getElementById("ocrFill").style.width="0%",document.getElementById("ocrTextArea").value="")}async function runOcrEngine(){if(!selectedOcrFile){"function"==typeof showAlert&&showAlert("Please select an image first!");return}let e=document.getElementById("ocrStartBtn"),t=document.getElementById("ocrStatus"),n=document.getElementById("ocrFill"),l=document.getElementById("ocrTextArea");e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Processing...',l.value="";try{t.textContent="Enhancing image details...",n.style.width="10%";let a=await new Promise((e,t)=>{let n=new FileReader;n.onload=t=>{let n=new Image;n.onload=()=>e(n),n.src=t.target.result},n.readAsDataURL(selectedOcrFile)}),r=document.createElement("canvas"),o=cv.imread(a),i=new cv.Mat;cv.cvtColor(o,i,cv.COLOR_RGBA2GRAY,0),cv.threshold(i,i,0,255,cv.THRESH_BINARY|cv.THRESH_OTSU),cv.imshow(r,i),n.style.width="30%",t.textContent="AI is reading text...";let c=await Tesseract.recognize(r,"ben+eng",{logger(e){if("recognizing text"===e.status){let l=30+Math.round(70*e.progress);t.textContent=`Analyzing: ${l}%`,n.style.width=l+"%"}}});c.data.text&&c.data.text.trim().length>0?(l.value=c.data.text,t.textContent="âœ“ Text successfully extracted.",n.style.width="100%"):t.textContent="No readable text found.",o.delete(),i.delete()}catch(d){console.error(d),t.textContent="Error: Conversion failed."}finally{e.disabled=!1,e.innerHTML='<i class="fa-solid fa-bolt"></i> Start Extraction'}}function copyExtractedText(){let e=document.getElementById("ocrTextArea");if(!selectedOcrFile||!e.value.trim()){"function"==typeof showAlert&&showAlert("Please extract text from an image first!");return}e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value)}document.getElementById("ocrFileInput").addEventListener("change",function(e){let t=e.target.files[0];t&&(selectedOcrFile=t,document.getElementById("ocrFileName").innerText=t.name)});
